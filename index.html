<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ¯ãƒ³ãƒŠã‚¤ãƒˆäººç‹¼ï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆï¼‰</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background-color: #f9f9f9; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input, button { font-size: 16px; padding: 12px; margin: 8px 0; width: 90%; box-sizing: border-box; }
        button { background-color: #4CAF50; color: white; border: none; cursor: pointer; border-radius: 5px; }
        button:hover { opacity: 0.9; }
        button.reset-btn { background-color: #ff4444; margin-top: 20px; font-size: 14px; }
        .hidden { display: none; }
        #player-list { list-style: none; padding: 0; }
        #player-list li { background: #e8f5e9; margin: 5px 0; padding: 10px; border-radius: 5px; border-bottom: 1px solid #c8e6c9; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸº ãƒ¯ãƒ³ãƒŠã‚¤ãƒˆäººç‹¼<br><small>ï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ ï¼‰</small></h1>

        <div id="login-screen">
            <input type="text" id="username" placeholder="åå‰ã‚’å…¥åŠ›">
            <input type="password" id="password" placeholder="åˆè¨€è‘‰ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰">
            <button id="login-btn">éƒ¨å±‹ã«å…¥ã‚‹</button>
            <p id="error-msg" class="error"></p>
        </div>

        <div id="game-screen" class="hidden">
            <h2>å‚åŠ è€…ãƒªã‚¹ãƒˆ</h2>
            <ul id="player-list">
                </ul>
            <p>å…¨å“¡æƒã£ãŸã‚‰ã‚²ãƒ¼ãƒ é–‹å§‹ï¼</p>
            
            <hr>
            <button id="reset-btn" class="reset-btn">ãƒ¡ãƒ³ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆè§£æ•£ï¼‰</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, remove, onDisconnect } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

        // â˜…è¨­å®š1: å‹é”ã¨æ±ºã‚ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«æ›¸ãæ›ãˆã¦ãã ã•ã„
        const PASSWORD = "2216";

        // â˜…è¨­å®š2: éƒ¨å±‹ã®åå‰ï¼ˆå›ºå®šï¼‰
        const ROOM_ID = "my_private_room";

        // Firebaseè¨­å®šï¼ˆã‚ãªãŸã®ã‚‚ã®ï¼‰
        const firebaseConfig = {
            apiKey: "AIzaSyCZZlMXREYtPTFXMTrjtATsa1xShWmZIZI",
            authDomain: "werewolf-756e4.firebaseapp.com",
            databaseURL: "https://werewolf-756e4-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "werewolf-756e4",
            storageBucket: "werewolf-756e4.firebasestorage.app",
            messagingSenderId: "935198400486",
            appId: "1:935198400486:web:4ad43bbc49adac97a6c027",
            measurementId: "G-Q7LBVYBN3Z"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // è¦ç´ ã®å–å¾—
        const loginScreen = document.getElementById('login-screen');
        const gameScreen = document.getElementById('game-screen');
        const errorMsg = document.getElementById('error-msg');

        // --- ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç† ---
        document.getElementById('login-btn').addEventListener('click', () => {
            const name = document.getElementById('username').value;
            const inputPass = document.getElementById('password').value;

            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!name) {
                errorMsg.textContent = "åå‰ã‚’å…¥ã‚Œã¦ãã ã•ã„";
                return;
            }
            if (inputPass !== PASSWORD) {
                errorMsg.textContent = "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™";
                return;
            }

            // ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
            errorMsg.textContent = "";
            joinRoom(name);
        });

        // --- éƒ¨å±‹ã«å‚åŠ ã™ã‚‹å‡¦ç† ---
        function joinRoom(name) {
            loginScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');

            // 1. Firebaseã«è‡ªåˆ†ã®åå‰ã‚’æ›¸ãè¾¼ã‚€
            const myRef = ref(db, `rooms/${ROOM_ID}/players/${name}`);
            set(myRef, {
                role: "undecided",
                status: "online"
            });

            // ã€é‡è¦ã€‘ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ãŸã‚‰è‡ªå‹•ã§æ¶ˆãˆã‚‹ã‚ˆã†ã«ã™ã‚‹è¨­å®š
            onDisconnect(myRef).remove();

            // 2. éƒ¨å±‹ã®çŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã™ã‚‹
            const playersRef = ref(db, `rooms/${ROOM_ID}/players`);
            onValue(playersRef, (snapshot) => {
                const listElement = document.getElementById('player-list');
                listElement.innerHTML = ""; // ãƒªã‚»ãƒƒãƒˆ

                const data = snapshot.val();
                if (data) {
                    // ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã€ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
                    Object.keys(data).forEach((playerName) => {
                        const li = document.createElement('li');
                        li.textContent = playerName + (playerName === name ? " (è‡ªåˆ†)" : "");
                        listElement.appendChild(li);
                    });
                } else {
                    // èª°ã‚‚ã„ãªã„å ´åˆ
                    listElement.innerHTML = "<li>ã¾ã èª°ã‚‚ã„ã¾ã›ã‚“</li>";
                }
            });
        }

        // --- ãƒªã‚»ãƒƒãƒˆå‡¦ç†ï¼ˆå…¨å“¡ã‚’é€€å‡ºã•ã›ã‚‹ï¼‰ ---
        document.getElementById('reset-btn').addEventListener('click', () => {
            if(confirm("æœ¬å½“ã«å…¨å“¡ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆã—ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
                remove(ref(db, `rooms/${ROOM_ID}/players`));
            }
        });
    </script>
</body>
</html>
