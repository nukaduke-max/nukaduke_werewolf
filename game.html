<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚²ãƒ¼ãƒ ç”»é¢</title>
    <style>body{text-align:center; padding:20px; font-family:sans-serif;}</style>
</head>
<body>
    <h1>ğŸ® ã‚²ãƒ¼ãƒ é–‹å§‹ï¼</h1>
    <h2 id="welcome-msg"></h2>
    
    <div id="status-area">
        <p>ã‚ãªãŸã®å½¹è·ã‚’ç¢ºèªã—ã¦ã„ã¾ã™...</p>
    </div>

    <h1 id="my-role" style="font-size:3em; color:red; font-weight:bold;">???</h1>

    <p id="debug-log" style="color:gray; font-size:0.8em; margin-top:50px;"></p>

    <script type="module">
        // config.js ã‹ã‚‰å¿…è¦ãªé“å…·ã‚’èª­ã¿è¾¼ã‚€
        import { db, ref, onValue, ROOM_ID } from './config.js';

        // URLã‹ã‚‰è‡ªåˆ†ã®åå‰ã‚’å–ã‚Šå‡ºã™
        const params = new URLSearchParams(window.location.search);
        const myName = params.get('name');

        const logArea = document.getElementById('debug-log');
        const roleArea = document.getElementById('my-role');

        if (!myName) {
            document.getElementById('welcome-msg').textContent = "ã‚¨ãƒ©ãƒ¼: åå‰ãŒä¸æ˜ã§ã™";
        } else {
            document.getElementById('welcome-msg').textContent = `${myName}ã•ã‚“`;
            logArea.textContent = "ãƒ‡ãƒ¼ã‚¿ã‚’å¾…æ©Ÿä¸­...";

            // â˜…ã“ã“ã‚’ä¿®æ­£: get ã§ã¯ãªã onValue ã§ç¢ºå®Ÿã«ãƒ‡ãƒ¼ã‚¿ã‚’å¾…ã¡ä¼ã›ã™ã‚‹
            const myDataRef = ref(db, `rooms/${ROOM_ID}/players/${myName}`);
            
            onValue(myDataRef, (snapshot) => {
                const data = snapshot.val();
                
                if (data && data.role) {
                    // å½¹è·ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆ
                    roleArea.textContent = data.role;
                    document.getElementById('status-area').innerHTML = "<p>ã‚ãªãŸã®å½¹è·ã¯...</p>";
                    logArea.textContent = "ãƒ‡ãƒ¼ã‚¿å—ä¿¡æˆåŠŸ";
                } else {
                    // ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚‹ã‘ã©å½¹è·ãŒå…¥ã£ã¦ã„ãªã„ã€ã¾ãŸã¯ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆ
                    logArea.textContent = "ã¾ã å½¹è·ãƒ‡ãƒ¼ã‚¿ãŒå±Šã„ã¦ã„ã¾ã›ã‚“ (Retrying...)";
                }
            }, (error) => {
                // ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸå ´åˆ
                roleArea.textContent = "ã‚¨ãƒ©ãƒ¼";
                logArea.textContent = "é€šä¿¡ã‚¨ãƒ©ãƒ¼: " + error.message;
            });
        }
    </script>
</body>
</html>
